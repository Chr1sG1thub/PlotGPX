<!DOCTYPE html>
<html>
<head>
  <title>Leaflet GPX Example</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-gpx@1.7.1/leaflet-gpx.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.polylineDecorator/1.7.0/leaflet.polylineDecorator.min.js"></script>
</head>
<body>
  <div id="map" style="height: 500px;"></div>

  <script>
const locations = [
  { name: "Alenya", lat: 42.63980194	, lon: 2.973538916 },
  { name: "ThÃ©za", lat: 42.6383408	, lon: 2.9512366 },
  { name: "Saint-Cyprien", lat: 42.6403122	, lon: 3.032468531 }
];
    // Create the Leaflet map
    var map = L.map('map').setView([45.0, 0], 5);

    // Add a base tile layer (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18
    }).addTo(map);

    // Load and add the GPX track (replace 'path/to/your.gpx' with your GPX file URL)
    new L.GPX('Thuir - Canohes - Villeneuve-de-la-Raho - Theza - Alenya - St-Cyprien (AR).gpx', {
      async: true,
      marker_options: {
        startIconUrl: 'https://leafletjs.com/examples/custom-icons/leaf-green.png',
        endIconUrl: 'https://leafletjs.com/examples/custom-icons/leaf-red.png',
        shadowUrl: 'https://leafletjs.com/examples/custom-icons/leaf-shadow.png'
      }
  .on('loaded', function (e) {
    const gpxLayer = e.target;
    map.fitBounds(gpxLayer.getBounds());

    // Find all polylines (tracks and route lines) in the layer group
    const polylines = [];
    gpxLayer.eachLayer(function (layer) {
      if (layer instanceof L.Polyline) {
        polylines.push(layer);
      }
    });

    if (polylines.length === 0) {
      console.error('No polylines found in GPX layer!');
      return;
    }

    polylines.forEach(function (polyline) {
      L.polylineDecorator(polyline, {
        patterns: [{
          offset: '5%',
          repeat: '12%',
          symbol: L.Symbol.arrowHead({
            pixelSize: 12,
            polygon: true,
            pathOptions: { color: 'red', weight: 2, opacity: 1 }
          })
        }]
      }).addTo(map);
    });
  }).addTo(map);

    // Add markers for each location
locations.forEach(loc => {
 const myIcon = L.divIcon({
    className: 'custom-div-icon',
    html: `<span style="color: blue;background-color: white; opacity: 0.5"><strong>${loc.name}</strong></span>`,
    iconSize: [10, 24],
    iconAnchor: [5, -5]
  });

  L.marker([loc.lat, loc.lon], { icon: myIcon }).addTo(map);
});
    
  </script>
</body>
</html>
